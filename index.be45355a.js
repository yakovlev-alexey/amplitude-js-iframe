var e={};Object.defineProperty(e,"__esModule",{value:!0}),e.getIframeMessagePort=e.AmplitudeIframeClient=void 0;var t={};Object.defineProperty(t,"__esModule",{value:!0}),t.AmplitudeIframeClient=void 0;var i={};Object.defineProperty(i,"__esModule",{value:!0}),i.DEFAULT_POLLING_INTERVAL_MS=i.DOM_LOADED_STATES=i.DEFAULT_INSTANCE_ID=void 0,i.DEFAULT_INSTANCE_ID="default_instance_id",i.DOM_LOADED_STATES=["loaded","complete","interactive"],i.DEFAULT_POLLING_INTERVAL_MS=500;class s{constructor(e){this._isInitialized=!1,this._port=null,this._queue=[],this._instanceId=e}static getInstance(e){const t="string"==typeof e&&Boolean(e)?e.toLowerCase():i.DEFAULT_INSTANCE_ID,n=this._instances[t];return n||(this._instances[t]=new s(t))}init(e,t,i,s){this._isInitialized?console.error(`Client "${this._instanceId}": already initialized`):e?"string"==typeof t&&t?(this._port=e,this._waitForInitialization(t,i,s)):console.error(`Client "${this._instanceId}": apiKey is required`):console.error(`Client "${this._instanceId}": port or iframe id is required`)}setUserId(e){this._isInitialized?this._postMessage("id",{userId:e}):this._queue.push(["id",{userId:e}])}setUserProperties(e){this._isInitialized?this._postMessage("properties",{properties:e}):this._queue.push(["properties",{properties:e}])}logEvent(e,t){this._isInitialized?this._postMessage("event",{event:e,additional:t}):this._queue.push(["event",{event:e,additional:t}])}_waitForInitialization(e,t,s){this._postMessage("init",{userId:t,apiKey:e,config:s});const n=setInterval((()=>{this._postMessage("init",{userId:t,apiKey:e,config:s})}),i.DEFAULT_POLLING_INTERVAL_MS),r=e=>{const t=this._port===e.source&&"initialized"===e.data.type;(this._isInitialized||t)&&(this._clearQueue(),this._isInitialized=!0,console.log("is initialized"),clearInterval(n),window.removeEventListener("message",r))};window.addEventListener("message",r)}_postMessage(e,t){var s;const n=this._instanceId===i.DEFAULT_INSTANCE_ID?null:this._instanceId;null===(s=this._port)||void 0===s||s.postMessage({type:e,payload:Object.assign({instance:n},t)})}_clearQueue(){for(;this._queue.length;){const[e,t]=this._queue.pop();this._postMessage(e,t)}}}t.AmplitudeIframeClient=s,s._instances={},Object.defineProperty(e,"AmplitudeIframeClient",{enumerable:!0,get:function(){return t.AmplitudeIframeClient}});var n={};Object.defineProperty(n,"__esModule",{value:!0}),n.getIframeMessagePort=void 0;const r=e=>e instanceof HTMLIFrameElement;n.getIframeMessagePort=e=>new Promise(((t,s)=>{if(((e=window.document)=>i.DOM_LOADED_STATES.includes(e.readyState))()){const i=document.querySelector(e);return r(i)||s(new Error(`Provided selector ${e} doesn't yield an iframe`)),void t(i.contentWindow)}document.addEventListener("DOMContentLoaded",(()=>{const i=document.querySelector(e);r(i)||s(new Error(`Provided selector ${e} doesn't yield an iframe`)),t(i.contentWindow)}))})),Object.defineProperty(e,"getIframeMessagePort",{enumerable:!0,get:function(){return n.getIframeMessagePort}}),(async()=>{try{const t=await e.getIframeMessagePort("#iframe");e.AmplitudeIframeClient.getInstance().init(t,"5a5c2a0b4dac9ad7ab4461e20d3aa728")}catch(e){console.error(e)}})();document.getElementById("event").addEventListener("click",(()=>{e.AmplitudeIframeClient.getInstance().logEvent("test",{hello:"world",quick:["brown","fox"]})}));document.getElementById("user").addEventListener("click",(()=>{e.AmplitudeIframeClient.getInstance().setUserId("123")}));document.getElementById("properties").addEventListener("click",(()=>{e.AmplitudeIframeClient.getInstance().setUserProperties({role:"anon"})}));